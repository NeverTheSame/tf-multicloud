## Introduction
This document outlines the process of setting up and using Multi-Factor Authentication (MFA) with the AWS CLI. 
MFA adds an additional layer of security by requiring a second form of verification when accessing sensitive resources. 
The following steps describe how to obtain an MFA token and use it to access AWS resources via the CLI.

## Prerequisites
- AWS CLI installed and configured.
- An IAM user with MFA enabled.
- Access to your MFA device (e.g., a smartphone with an authenticator app).

## Instructions
### Step 1: Obtaining MFA Token
To perform actions that require MFA authentication, you first need to obtain a session token using your MFA device. 
This is done with the aws sts get-session-token command.
```
aws sts get-session-token --serial-number [mfa_device_arn] --token-code [authenticator_code]
```
- **mfa_device_arn**: Replace this with the ARN of your MFA device. 
You can find this in the AWS Management Console under 
IAM → Users → __your username__ → Security credentials → Assigned MFA device.
- **authenticator_code**: This is the 6-digit code generated by your MFA device.

**Example:**
```
aws sts get-session-token --serial-number arn:aws:iam::XXX:mfa/SE --token-code 123456
```

### Step 2: Configuring Your AWS Profile
Once you have your session token, you'll receive an aws_access_key_id, aws_secret_access_key, and an aws_session_token. 
You need to configure these in your AWS profile.

**Configuration:**
1. Open your AWS credentials file, typically located at ~/.aws/credentials.
1. Add a new profile or modify an existing one with the new session credentials:

```
[aws_profile]
aws_access_key_id=XXX
aws_secret_access_key=XXX
aws_session_token=XXXX
```

Replace XXX with the respective values from the session token you received.

### Step 3: Using AWS CLI with MFA
Now that your MFA-enabled profile is configured, you can use the AWS CLI as you normally would, 
specifying the profile with the --profile option.
```
aws --profile aws_profile s3 ls
```

**Expected Output:**
- A list of S3 buckets under your account:
```
2023-02-09 07:36:43 aws-cloudtrail-logs-XXX-1f3ae870
2023-02-09 07:18:35 config-bucket-XXX
...
2024-01-02 14:57:33 tf-state-bucket
```

### Important Notes
The session tokens are temporary and typically last for a few hours. Once expired, you'll need to repeat the process to 
obtain a new token. Notice that the aws_access_key_id and aws_secret_access_key in your MFA-enabled profile are 
different from your regular access keys. This is expected and part of the security measures provided by MFA.
